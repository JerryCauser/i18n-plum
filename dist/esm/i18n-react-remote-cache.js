import{useContext as w,createContext as S,useState as F,useRef as E,useEffect as P}from"react";function N(i,e,t="."){if(i==null)return Array.isArray(e)?e.join(t):e;if(typeof e=="string"&&(e=e.split(t)),!Array.isArray(e)||e.length===0)return;if(e.length===1)return i.get(e[0]);let r=i.get(e[0]);for(let n=1;Boolean(r)&&n<e.length;++n)r=r.get(e[n]);return r}var I=N;function j(i,e){let t=/{{(.*?)}}/g;return i.replace(t,(r,n)=>{let a=n.trim().split(".");if(a.length===0)return"";let c=e[a[0]];if(a.length>1)for(let s=1;Boolean(c)&&s<a.length;++s)c=c[a[s]];return typeof c=="string"?c:""})}var y=j;function C(i){var t;let e=new Map;for(let r in i)if(Object.hasOwn(i,r)){let n=i[r];n!==null&&typeof n=="object"&&((t=n.constructor)==null?void 0:t.name)==="Object"?e.set(r,C(n)):e.set(r,n)}return e}var o=C;var p=class{#e;#t=new Map;#n;#r=new Map;constructor(e){this.#t=o((e==null?void 0:e.tables)??{}),this.#e=(e==null?void 0:e.locale)??"",this.#n=(e==null?void 0:e.separator)??"."}get locale(){return this.#e}has(e){return this.#t.has(e)}set(e,t){t instanceof Map?this.#t.set(e,t):this.#t.set(e,o(t))}extend(e,t){let r=this.#t.get(e);if(r==null)return this.set(e,t);t instanceof Map||(t=o(t));for(let n of t)r.set(n[0],n[1])}delete(e){return this.#t.delete(e)}setLocale(e){this.#e!==e&&(this.#e=e,this.emit("change",e))}get(e){return this.#t.get(e)}t(e,t,r){let n=this.get(r??this.#e),a=I(n,e,this.#n)??e.toString();return typeof a=="function"?a(t):y(a,t)}emit(e,t){let r=!1;for(let[n,a]of this.#r)e===a.eventName&&(setTimeout(()=>n(t),0),a.once&&this.#r.delete(n),r=!0);return r}on(e,t){return this.#r.set(t,{eventName:e,once:!1}),this}once(e,t){return this.#r.set(t,{eventName:e,once:!0}),this}off(e){return this.#r.delete(e),this}},O=p;var h=class extends O{#e;#t;#n;#r;constructor(e){super(e),this.#e=(e==null?void 0:e.fetcher)??fetch,this.#n=(e==null?void 0:e.languageToken)??"{{lang}}",this.#t=(e==null?void 0:e.path)??`/i18n/${this.#n}.json`,this.#r=(e==null?void 0:e.pathCompiler)??function(t,r,n){return t.replace(r,n)}}async loadLocale(e){if(!this.has(e)){let t=this.#r(this.#t,this.#n,e),r=await this.#e(t);r instanceof Response?r=await r.json():typeof r=="string"&&(r=JSON.parse(r)),this.extend(e,r)}super.setLocale(e)}setLocale(e){this.loadLocale(e).catch(console.error)}},v=h;var l=class extends v{#e;constructor(e){super(e),this.#e=(e==null?void 0:e.storage)??new Map}async loadLocale(e){if(!this.has(e)){let t=this.#e.get(e);typeof t=="string"&&(t=JSON.parse(t)),t!==null&&this.extend(e,t)}return await super.loadLocale(e)}};var g=class extends l{};function X(i){i??={};let{defaultLocale:e="en",path:t,storage:r,fetcher:n,pathCompiler:a,languageToken:c}=i,s=new g({path:t,storage:r,fetcher:n,pathCompiler:a,languageToken:c});s.setLocale(e);let u=S(s);function T(d){let{children:b,locale:f=null,lngDict:m=null}=d,[,D]=F(0),R=()=>D(L=>L+1),x=E(!0);return P(()=>(s.on("change",R),()=>{s.off(R)})),x.current&&m!==null&&f!==null&&(x.current=!1,s.set(f,m),s.setLocale(f)),<u.Provider value={s}>{b}</u.Provider>}function M(){return w(u)}return{I18nContext:u,I18nWrapper:T,useI18n:M}}export{X as initI18n};
//# sourceMappingURL=i18n-react-remote-cache.js.map
